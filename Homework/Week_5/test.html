<!-- all code retrieved from http://datamaps.github.io/ -->
<!-- This code was used during the design project for Data Processing -->
<!-- billionaires csv dataset 2015 https://raw.githubusercontent.com/richard512/Little-Big-Data/master/top1000billionaires.csv -->
<!DOCTYPE html>
<html>
<meta charset="utf-8">
<body>
  <script src="https://d3js.org/d3.v3.min.js"></script>

  <script src="https://d3js.org/d3-queue.v1.min.js"></script>

  <link rel="stylesheet" href="stylesheet.css">

  <h2>Pie chart test</h2>
  <!-- <div id="pie"></div> -->
  <div id="pieHidden">
    <div id="pie"></div>
  </div>
<script>
window.onload = function(){

  // http://bl.ocks.org/mapsam/6090056
  queue()
    .defer(d3.json, 'top1000billionaires.json')
    .defer(d3.json, 'imf_gdp.json')
    .awaitAll(data);

  function data(error, response){
    var dataset_billionaires = response[0]['data']
    var dataset_GDP = response[1]['data']


    /*
     * Calculates the quartiles of the age of billionaires in a specified country
     */
    function calculate_age_quartiles(country){

      // initiate quartile counters
      quartile1 = 0
      quartile2 = 0
      quartile3 = 0
      quartile4 = 0

      // loop over dataset
      for(i = 0; i < dataset_billionaires.length; i++){

        // if billionaire in specified country is below or equal to 25 years old
        if ((dataset_billionaires[i]['Country'] == country) && (dataset_billionaires[i]['Age'] <= 25)) {
            quartile1 += 1
        }

        // if billionaire in specified country is below or equal to 50 years old
        else if ((dataset_billionaires[i]['Country'] == country) && (dataset_billionaires[i]['Age'] <= 50)) {
            quartile2 += 1
        }

        // if billionaire in specified country is below or equal to 75 years old
        else if ((dataset_billionaires[i]['Country'] == country) && (dataset_billionaires[i]['Age'] <= 75)) {
            quartile3 += 1
        }

        // if billionaire in specified country is below or equal to 100 years old
        else if ((dataset_billionaires[i]['Country'] == country) && (dataset_billionaires[i]['Age'] <= 100)) {
            quartile4 += 1
        };
    };
      return quartile1, quartile2, quartile3, quartile4
    }

    /* Creates pie chart showing the different age groups of billionaries in
     * percentages.
     * Retrieved from http://bl.ocks.org/kiranml1/6872886
     */
    function create_pie_chart(country){

      calculate_age_quartiles(country)

      var canvas = d3.select('#pie')
                .append('svg')
                .attr({'width':650,'height':500});
                
        var data = [{"label":"one", "value": quartile1},
                {"label":"two", "value": quartile2},
                {"label":"three", "value": quartile3},
                {"label":"four", "value": quartile4},];

                var colors = ['red','blue'];

                var colorscale = d3.scale.linear().domain([0,data.length]).range(colors);

        var arc = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(100);

        var arcOver = d3.svg.arc()
                .innerRadius(0)
                    .outerRadius(150 + 10);

        var pie = d3.layout.pie()
                .value(function(d){ return d.value; });

        var renderarcs = canvas.append('g')
                .attr('transform','translate(440,200)')
                .selectAll('.arc')
                .data(pie(data))
                .enter()
                .append('g')
                .attr('class',"arc");

        renderarcs.append('path')
            .attr('d',arc)
            .attr('fill',function(d,i){ return colorscale(i); })
            .on("mouseover", function(d) {
                      d3.select(this).transition()
                         .duration(1000)
                         .attr("d", arcOver);
                     })
            .on("mouseout", function(d) {
                      d3.select(this).transition()
                         .duration(1000)
                         .attr("d", arc);
                     });

        renderarcs.append('text')
            .attr('transform',function(d) {
                var c = arc.centroid(d);
                console.log(c);
                      return "translate(" + c[0] +"," + c[1]+ ")";
                    })
            .text(function(d){ return d.value; });

    }
    create_pie_chart("France");
  }

}
</script>

</body>
</html
